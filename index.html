
<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>CampusHelper - Hybrid Chatbot</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f6f8; padding: 2rem; display: flex; justify-content: center; }
    #chatbox { background: #fff; width: 100%; max-width: 600px; padding: 1rem; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    h2 { margin-top: 0; }
    .bubble { margin: 0.5rem 0; padding: 0.75rem 1rem; border-radius: 10px; max-width: 80%; }
    .user { background: #dbeafe; align-self: flex-end; }
    .bot { background: #e5e7eb; align-self: flex-start; }
    .chatline { display: flex; flex-direction: column; }
    input, button { padding: 0.75rem; font-size: 1rem; margin-top: 1rem; width: 100%; }
    button { background: #2563eb; color: white; border: none; cursor: pointer; }
    button:hover { background: #1e40af; }
  </style>
</head>
<body>
  <div id="chatbox">
    <h2>ðŸŽ“ CampusHelper (Hybrid)</h2>
    <div id="chat" class="chatline"></div>
    <input type="text" id="userInput" placeholder="Frage hier..." />
    <button onclick="sendMessage()">Senden</button>
  </div>

<script>
  const qnaEndpoint = "https://chatbot-jattus.cognitiveservices.azure.com/language/:query-knowledgebases?projectName=CampusHelper&api-version=2021-10-01&deploymentName=production";
  const qnaApiKey = "EbvNA38yknUy3j6X2TiDT7Jy4o9zWDrLnczvmgmaqRE9PWA70GRtJQQJ99BFACPV0roXJ3w3AAAaACOGmCSu";

  const gptEndpoint = "https://aayus-mcduf5yn-swedencentral.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2025-01-01-preview";
  const gptApiKey = "9mPKBUdCCwKydTq9fN9WOQlYbtzC9WPfD6qnsIbKkhhk41Q2BIKBJQQJ99BFACfhMk5XJ3w3AAAAACOGeAUn";

  async function sendMessage() {
    const input = document.getElementById("userInput");
    const question = input.value.trim();
    if (!question) return;

    addMessage(question, "user");
    input.value = "";

    try {
      const qnaResponse = await fetch(qnaEndpoint, {
        method: "POST",
        headers: {
          "Ocp-Apim-Subscription-Key": qnaApiKey,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ question })
      });

      const qnaData = await qnaResponse.json();
      const qnaAnswer = qnaData.answers?.[0]?.answer;

      if (qnaAnswer && qnaAnswer !== "Keine passende Antwort gefunden.") {
        addMessage(qnaAnswer, "bot");
      } else {
        const gptResponse = await fetch(gptEndpoint, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "api-key": gptApiKey
          },
          body: JSON.stringify({
            messages: [
              { role: "system", content: "Du bist ein freundlicher Studienassistent an der THM. Antworte informativ." },
              { role: "user", content: question }
            ],
            temperature: 0.7,
            max_tokens: 800
          })
        });

        const gptData = await gptResponse.json();
        const gptAnswer = gptData.choices?.[0]?.message?.content || "Es gab ein Problem bei der GPT-Antwort.";
        addMessage(gptAnswer, "bot");
      }
    } catch (error) {
      console.error(error);
      addMessage("Fehler beim Abrufen der Antwort.", "bot");
    }
  }

  function addMessage(text, type) {
    const chat = document.getElementById("chat");
    const msg = document.createElement("div");
    msg.className = `bubble ${type}`;
    msg.innerText = text;
    chat.appendChild(msg);
    chat.scrollTop = chat.scrollHeight;
  }
</script>
</body>
</html>
